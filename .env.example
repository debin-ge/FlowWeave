# ============================================================
# FlowWeave 环境变量模板
# 用法：cp .env.example .env
# ============================================================

# ---------- Docker Compose 基础设施配置（Compose 使用） ----------
# App 对外映射端口（host）
APP_PORT=8080

# PostgreSQL Service
POSTGRES_IMAGE=postgres:16-alpine
POSTGRES_DB=flowweave
POSTGRES_USER=flowweave
POSTGRES_PASSWORD=flowweave
POSTGRES_PORT=5432

# Redis Service
REDIS_IMAGE=redis:7-alpine
REDIS_PORT=6379
REDIS_APPENDONLY=yes

# OpenSearch Service
OPENSEARCH_VERSION=2.19.4
OPENSEARCH_HTTP_PORT=9200
OPENSEARCH_METRICS_PORT=9600
OPENSEARCH_DISCOVERY_TYPE=single-node
# OpenSearch 2.12+ 推荐使用：true=禁用 security 插件（本地开发建议）
OPENSEARCH_SECURITY_DISABLED=true
# 与上面联动：禁用 security 时通常同时禁用 demo config 初始化
OPENSEARCH_DISABLE_DEMO_CONFIG=true
# 仅当 OPENSEARCH_SECURITY_DISABLED=false 时必填（需强密码）
OPENSEARCH_INITIAL_ADMIN_PASSWORD=
OPENSEARCH_JAVA_OPTS=-Xms512m -Xmx512m
# 中文分词 IK 插件下载地址（必须配置，且版本需与 OPENSEARCH_VERSION 匹配）
OPENSEARCH_IK_PLUGIN_URL=https://your-plugin-download-url/opensearch-analysis-ik.zip

# ---------- 全局配置文件（可选，应用使用） ----------
# 可选：JSON 配置文件路径。加载顺序为：默认值 -> 配置文件 -> 环境变量（例：./config/app.json）
APP_CONFIG_FILE=

# ---------- 服务（应用使用） ----------
HOST=0.0.0.0
PORT=8080
SERVER_READ_TIMEOUT=30
SERVER_WRITE_TIMEOUT=600
# 单次工作流执行超时（秒）
SERVER_RUN_TIMEOUT=300

# ---------- 运行时启动/停机保护（应用使用） ----------
RUNTIME_MIGRATION_TIMEOUT=10
RUNTIME_REDIS_PING_TIMEOUT=3
RUNTIME_MTM_ENSURE_TIMEOUT=5
RUNTIME_SHUTDOWN_TIMEOUT=10
RUNTIME_OPENSEARCH_PING_TIMEOUT=5

# ---------- 数据库与缓存（应用使用） ----------
# 默认使用 Compose 服务名连接；若改服务端口/账号，可同步修改这些 URL
DATABASE_URL=postgres://flowweave:flowweave@postgres:5432/flowweave?sslmode=disable
DATABASE_MAX_OPEN_CONNS=25
DATABASE_MAX_IDLE_CONNS=5
DATABASE_CONN_MAX_LIFETIME=300

REDIS_URL=redis://redis:6379/0

# ---------- 引擎配置（应用使用） ----------
ENGINE_MAX_WORKERS=4
ENGINE_NODE_TIMEOUT=300
ENGINE_MAX_NODE_STEPS=100

# ---------- LLM Provider (OpenAI 兼容) ----------
# API Key（必填，用于 LLM 节点）
OPENAI_API_KEY=sk-your-api-key-here
# API 基地址（可接入 OpenAI / Azure / DeepSeek / Ollama 等兼容服务）
OPENAI_BASE_URL=https://api.openai.com/v1
# TCP 连接超时（秒）
OPENAI_CONNECT_TIMEOUT=30
# TLS 握手超时（秒）
OPENAI_TLS_HANDSHAKE_TIMEOUT=30

# ---------- 记忆管理 ----------
SUMMARY_LLM_PROVIDER=openai
SUMMARY_LLM_MODEL=gpt-4o-mini

# ---------- Context-Gateway 压缩 ----------
GATEWAY_LLM_PROVIDER=openai
GATEWAY_LLM_MODEL=gpt-4o-mini
CONTEXT_WINDOW_SIZE=128000
COMPRESS_THRESHOLD_RATIO=0.70
COMPRESS_MIN_RECENT_TURNS=4

# ---------- 日志 ----------
LOG_LEVEL=info
LOG_FORMAT=text

# ---------- JWT 鉴权（多租户） ----------
# 必填：服务启动时会校验 JWT_SECRET
JWT_SECRET=test-secret-key-for-dev
JWT_ISSUER=

# ---------- RAG（应用使用） ----------
# 默认使用 Compose 服务名；如切换到外部 OpenSearch，可直接改为外部地址
OPENSEARCH_URL=http://opensearch:9200
OPENSEARCH_USERNAME=
OPENSEARCH_PASSWORD=
# HTTPS + 自签证书时可设为 true；生产建议 false 并使用受信任证书
OPENSEARCH_INSECURE_SKIP_VERIFY=true
# OpenSearch HTTP 客户端超时（秒）
OPENSEARCH_HTTP_TIMEOUT=30
OPENSEARCH_INDEX_PREFIX=rag

RAG_DEFAULT_MODE=bm25
RAG_DEFAULT_TOP_K=5
RAG_CHUNK_SIZE=512
RAG_CHUNK_OVERLAP=128

RAG_EMBEDDING_PROVIDER=openai
RAG_EMBEDDING_MODEL=text-embedding-3-small
RAG_EMBEDDING_DIMS=1536
# Embedding HTTP 超时（秒）
RAG_EMBEDDING_HTTP_TIMEOUT=60
# Embedding 请求批次大小（每批文本条数）
RAG_EMBEDDING_BATCH_SIZE=64

RAG_ENABLE_RERANK=false
RAG_RERANK_PROVIDER=openai
RAG_RERANK_MODEL=gpt-4o-mini

RAG_CACHE_TTL=300
# 检索缓存异步写入超时（秒）
RAG_CACHE_WRITE_TIMEOUT=2
# 文件上传最大大小（MB）
RAG_MAX_FILE_SIZE=50
